import unittest

from coursework_02 import coder
from coursework_02.coder import mixcolumns


class TestMathFunctions(unittest.TestCase):

    def test_key_expansion(self):
        key = [0x2B,0x28,0xab,0x09,0x7e,0xae,0xf7,0xcf,0x15,0xd2,0x15,0x4f,0x16,0xa6,0x88,0x3c]
        expanded_keys = coder.key_expansion(key)
        expanded_keys_expected = [
            [[0x2B,0x28,0xab,0x09],[0x7e,0xae,0xf7,0xcf],[0x15,0xd2,0x15,0x4f],[0x16,0xa6,0x88,0x3c]],
            [[0xa0,0x88,0x23,0x2a],[0xfa,0x54,0xa3,0x6c],[0xfe,0x2c,0x39,0x76],[0x17,0xb1,0x39,0x05]],

        ]
        self.assertEqual(expanded_keys[1], expanded_keys_expected[1])
        # for i in range(len(expanded_keys_expected)):
        #     self.assertEqual(expanded_keys[i], expanded_keys_expected[i])

    def test_shiftrows(self):
        matrix = [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12], [13, 14, 15, 16]]
        # Проверка правильности сложения
        self.assertEqual(coder.shiftrows(matrix), [[1, 2, 3, 4], [8, 5, 6, 7], [11, 12, 9, 10], [14, 15, 16, 13]])

    def test_subbytes(self):
        matrix = [[0x32,0x43,0xF6, 0xA8],[0x88,0x5A,0x30,0x8D],[0x31,0x31,0x98,0xA2],[0xE0,0x37,0x07,0x34]]
        matrix_control = [[0x23,0x1a,0x42, 0xc2], [0xc4,0xbe,0x04, 0x5d], [0xc7,0xc7,0x46, 0x3a],[0xe1,0x9a,0xc5, 0x18]]
        self.assertEqual(coder.subbytes(matrix), matrix_control)

    def test_mixcolumns(self):
        # Пример входной матрицы состояния (state)
        state = [
            [0x63, 0xf2, 0x01, 0xc6],
            [0x47, 0x0a, 0x01, 0xc6],
            [0xa2, 0x22, 0x01, 0xc6],
            [0xf0, 0x5c, 0x01, 0xc6]
        ]

        # Ожидаемый результат после применения mixcolumns
        expected_result = [
            [0x5d, 0x9f, 0x01, 0xc6],
            [0xe0, 0xdc, 0x01, 0xc6],
            [0x70, 0x58, 0x01, 0xc6],
            [0xbb, 0x9d, 0x01, 0xc6]
        ]

        # Применяем mixcolumns к состоянию
        result = mixcolumns(state)

        # Проверяем, что результат совпадает с ожидаемым
        self.assertEqual(result, expected_result)


if __name__ == "__main__":
    unittest.main()
